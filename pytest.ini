[pytest]
# ChatGPT Team Relay - pytest.ini (cleaned version)

# Discover all test_*.py anywhere in the repo
testpaths = .
python_files = test_*.py
addopts = -ra

# Async support for httpx / FastAPI tests
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Register custom markers
markers =
    integration: tests that hit a running relay/OpenAI API (slower, need real key)

# Env vars for tests – no real secrets here
env =
    APP_MODE=test
    ENVIRONMENT=test
    RELAY_NAME=ChatGPT Team Relay (pytest)

    # Make imports like "from app.main import app" work
    PYTHONPATH=.

    # IMPORTANT: base WITHOUT /v1. Your forwarder will add /v1 correctly.
    OPENAI_API_BASE=https://api.openai.com
    OPENAI_API_KEY=dummy-test-key
    OPENAI_ORG_ID=
    DEFAULT_MODEL=gpt-4o-mini

    # Relay behavior toggles
    CHAIN_WAIT_MODE=true
    ENABLE_STREAM=true
    RELAY_TIMEOUT=120
    PROXY_TIMEOUT=120

    # Tools + schema – needed by tests that hit /v1/tools etc.
    TOOLS_MANIFEST=app/manifests/tools_manifest.json
    VALIDATION_SCHEMA_PATH="ChatGPT-API_reference_ground_truth-2025-10-29.pdf"

# Logging – keep it informative but not too noisy
log_cli = true
log_cli_level = INFO
log_level = INFO
log_format = %(asctime)s [%(levelname)s] %(name)s - %(message)s
# NOTE: log_datefmt caused a PytestConfigWarning; omit unless you really need it.
