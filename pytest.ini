[pytest]
minversion = 8.0

# -ra : summary of skipped/xfail
# -q  : quieter output (tweak to taste)
# -m "not integration" : do NOT run integration tests by default
addopts = -ra -q -m "not integration"

testpaths = tests

# anyio / asyncio plugin config
asyncio_mode = strict
asyncio_default_fixture_loop_scope = function
asyncio_default_test_loop_scope = function

# Default logging level for tests
log_level = INFO

# ---------------------------------------------------------------------------
# Environment for local test runs
# (pytest-env plugin: these are injected into os.environ for all tests)
# ---------------------------------------------------------------------------
env =
    # Run the app in "test" mode
    APP_MODE = test
    ENVIRONMENT = test

    # Upstream OpenAI settings (for when you DO talk to upstream)
    # These are safe dummy defaults; integration tests against real OpenAI
    # should override OPENAI_API_KEY in your shell.
    OPENAI_API_BASE = https://api.openai.com/v1
    OPENAI_ASSISTANTS_BETA = assistants=v2
    OPENAI_REALTIME_BETA = realtime=v1
    OPENAI_API_KEY = dummy-tests-api-key

    # When using the OpenAI SDK against the relay, this is the base URL.
    # For *local* development you typically run:
    #   uvicorn app.main:app --port 8000
    # and point the SDK at http://127.0.0.1:8000/v1
    OPENAI_BASE_URL = http://127.0.0.1:8000/v1

    # Relay auth: by default make the SDK and the relay share the same key.
    # In local tests this lets the OpenAI SDK hit the relay without 401s.
    RELAY_AUTH_ENABLED = true
    RELAY_KEY = dummy

    # CORS / defaults (mostly irrelevant for pytest, but kept consistent)
    CORS_ALLOW_ORIGINS = http://localhost,https://chat.openai.com,https://platform.openai.com
    CORS_ALLOW_METHODS = GET,POST,PUT,PATCH,DELETE,OPTIONS
    CORS_ALLOW_HEADERS = Authorization,Content-Type,Accept

    # Default model aliases used by the relay
    DEFAULT_MODEL = gpt-4.1-mini
    REALTIME_MODEL = gpt-4o-realtime-preview

    # Reasonable default timeouts
    RELAY_TIMEOUT = 120
    PROXY_TIMEOUT = 120

# ---------------------------------------------------------------------------
# Markers
# ---------------------------------------------------------------------------
markers =
    integration: tests that hit external services or require real API keys
    render: tests that talk to the Render-hosted relay (network required)
