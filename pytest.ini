[pytest]
# Discover all test_*.py files anywhere in the repo
testpaths = .
python_files = test_*.py

# -ra: show extra summary info for (s)kipped, (x)failed, etc.
addopts = -ra

# Async support for httpx / FastAPI tests; plays well with TestClient and any async tests
asyncio_mode = auto

# -------------------------------------------------------------------
# Test environment variables (NO SECRETS)
# -------------------------------------------------------------------
env =
    # Runtime / mode
    APP_MODE=test
    ENVIRONMENT=test
    RELAY_NAME=ChatGPT Team Relay (pytest)

    # Make imports like "from app.main import app" work in tests
    PYTHONPATH=.

    # Upstream OpenAI API config used by forward_openai_request.
    # IMPORTANT: base WITHOUT /v1; the forwarder appends /v1 itself.
    OPENAI_API_BASE=https://api.openai.com
    OPENAI_API_KEY=dummy-test-key
    OPENAI_ORG_ID=
    DEFAULT_MODEL=gpt-4o-mini

    # Relay behavior toggles
    CHAIN_WAIT_MODE=true
    ENABLE_STREAM=true
    RELAY_TIMEOUT=120
    PROXY_TIMEOUT=120

    # Tools + schema – used by tools_api and validation middleware
    TOOLS_MANIFEST=app/manifests/tools_manifest.json
    VALIDATION_SCHEMA_PATH=ChatGPT-API_reference_ground_truth-2025-10-29.pdf

    # Logging – verbose is helpful under pytest
    LOG_LEVEL=debug
    LOG_FORMAT=json
    LOG_COLOR=false

    # ----------------------------------------------------------------
    # OPTIONAL: future-use vars for external / live integration tests
    # (Not used by the current offline pysuite; safe to keep.)
    # ----------------------------------------------------------------
    TEST_API_BASE_URL=http://127.0.0.1:8000
    TEST_OPENAI_API_KEY=dummy-test-key
