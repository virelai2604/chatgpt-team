[pytest]
minversion = 8.0

# -ra : summary of skipped/xfail
# -q  : quieter output (tweak to taste)
# -m "not integration" : do NOT run integration tests by default
addopts = -ra -q -m "not integration"

testpaths = tests

# anyio / asyncio plugin config
asyncio_mode = strict
asyncio_default_fixture_loop_scope = function
asyncio_default_test_loop_scope = function

# Default logging level for tests
log_level = INFO

# ---------------------------------------------------------------------------
# Environment for local test runs
# (pytest-env plugin: these are injected into os.environ for all tests)
# ---------------------------------------------------------------------------
env =
    # Run the app in "test" mode
    APP_MODE = test
    ENVIRONMENT = test

    # Upstream OpenAI settings (for when you DO talk to upstream)
    OPENAI_API_BASE = https://api.openai.com/v1
    OPENAI_ASSISTANTS_BETA = assistants=v2
    OPENAI_REALTIME_BETA = realtime=v1

    # Default-only so a real shell/CI secret can override it
    # (pytest-env supports the D: prefix for "set only if not already set"). 
    D:OPENAI_API_KEY = dummy-tests-api-key

    # When using the OpenAI SDK against the relay, this is the base URL.
    # (Client-side SDK behavior; do not use this for relay->OpenAI upstream.) 
    OPENAI_BASE_URL = http://127.0.0.1:8000/v1

    # Relay auth for tests
    RELAY_AUTH_ENABLED = true
    RELAY_KEY = dummy-tests-relay-key
    RELAY_AUTH_HEADER = x-relay-key

    # CORS / defaults
    CORS_ALLOW_ORIGINS = http://localhost,https://chat.openai.com,https://platform.openai.com
    CORS_ALLOW_METHODS = GET,POST,PUT,PATCH,DELETE,OPTIONS
    CORS_ALLOW_HEADERS = Authorization,Content-Type,Accept

    # Default model aliases used by the relay
    DEFAULT_MODEL = gpt-4.1-mini
    REALTIME_MODEL = gpt-4o-realtime-preview

    # Reasonable default timeouts
    RELAY_TIMEOUT = 120
    PROXY_TIMEOUT = 120

# ---------------------------------------------------------------------------
# Markers
# ---------------------------------------------------------------------------
markers =
    integration: tests that hit external services or require real API keys
    render: tests that talk to the Render-hosted relay (network required)
