# =========================================================
# ChatGPT Relay - pytest.ini (Final Fixed Version)
# =========================================================
[pytest]

# ---------------------------------------------------------
# Core Test Paths
# ---------------------------------------------------------
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# ---------------------------------------------------------
# Asyncio Compatibility
# ---------------------------------------------------------
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# ---------------------------------------------------------
# Logging & Output
# ---------------------------------------------------------
addopts =
    --color=yes
    --tb=short
    --log-cli-level=INFO
    --maxfail=2
    -rfEsxXw

# ---------------------------------------------------------
# Coverage Integration
# ---------------------------------------------------------
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::pytest.PytestDeprecationWarning
    ignore::RuntimeWarning

# ---------------------------------------------------------
# Environment Overrides (Safe Defaults)
# ---------------------------------------------------------
env =
    OPENAI_API_KEY=dummy-test-key
    OPENAI_API_BASE=https://api.openai.com/v1
    PYTHONUNBUFFERED=1
    LOG_LEVEL=INFO
    TESTING=True

# ---------------------------------------------------------
# Parallel Testing (pytest-xdist)
# ---------------------------------------------------------
norecursedirs = .* build dist htmlcov logs tmp .venv __pycache__

# ---------------------------------------------------------
# Report Style
# ---------------------------------------------------------
console_output_style = count
log_format = %(asctime)s [%(levelname)s] %(message)s
log_date_format = %Y-%m-%d %H:%M:%S
