# ==========================================================
# üöÄ ChatGPT Team Relay ‚Äî Render Deployment Configuration
# ----------------------------------------------------------
# This file defines the Render service that hosts your
# FastAPI-based OpenAI relay. It‚Äôs designed to work
# without any database logger or persistent disk.
# ==========================================================

services:
  - type: web
    name: chatgpt-team-relay
    env: python

    # ------------------------------------------------------
    # üß± BUILD COMMAND
    # ------------------------------------------------------
    # Upgrades pip and installs all project dependencies.
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt

    # ------------------------------------------------------
    # üöÄ START COMMAND
    # ------------------------------------------------------
    # Uvicorn serves FastAPI app. Render automatically
    # injects $PORT at runtime ‚Äî never hardcode a number.
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT

    # ------------------------------------------------------
    # üåê ENVIRONMENT VARIABLES
    # ------------------------------------------------------
    envVars:
      # Runtime mode
      - key: APP_MODE
        value: production

      # Relay metadata
      - key: RELAY_NAME
        value: ChatGPT Team Relay
      - key: DEFAULT_MODEL
        value: gpt-4o

      # API base URL
      - key: OPENAI_BASE_URL
        value: https://api.openai.com

      # Disable DB logging for Render-safe operation
      - key: ENABLE_DB_LOGGING
        value: false

      # Optional: turn off debug logging for cleaner logs
      - key: DEBUG
        value: false

      # Ensures all imports like `from app.routes...` resolve
      - key: PYTHONPATH
        value: .

    # ------------------------------------------------------
    # ‚ù§Ô∏è HEALTH CHECK
    # ------------------------------------------------------
    # Render pings this path to verify your service is alive.
    healthCheckPath: /health

    # ------------------------------------------------------
    # üîÅ DEPLOYMENT BEHAVIOR
    # ------------------------------------------------------
    # Automatically deploy when you push to the linked branch.
    autoDeploy: true

    # Optional ‚Äî keep warm (avoid hibernation delay)
    # plan: starter    # uncomment if you upgrade from free tier
