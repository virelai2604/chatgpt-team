services:
  - type: web
    name: chatgpt-team-relay
    env: python
    plan: starter
    runtime: python3

    buildCommand: "pip install -r requirements.txt"

    # Launch the FastAPI relay with uvicorn — critical for streaming SSE
    startCommand: "uvicorn main:app --host 0.0.0.0 --port $PORT --log-level info"

    autoDeploy: true
    healthCheckPath: /health

    envVars:
      - key: APP_MODE
        value: production

      - key: RELAY_NAME
        value: "ChatGPT Team Relay"

      - key: RELAY_VERSION
        value: "Ground Truth Edition v2025.10"

      - key: OPENAI_BASE_URL
        value: "https://api.openai.com"

      # ⚠️ DO NOT check in this value — add it manually in Render Dashboard
      - key: OPENAI_API_KEY
        sync: false

      - key: DEFAULT_MODEL
        value: gpt-4o-mini

      - key: ENABLE_STREAM
        value: "true"

      - key: PYTHONUNBUFFERED
        value: "1"

      - key: CORS_ALLOW_ORIGINS
        value: "https://chat.openai.com,https://platform.openai.com"

      - key: CORS_ALLOW_METHODS
        value: "GET,POST,PUT,PATCH,DELETE,OPTIONS"

      - key: CORS_ALLOW_HEADERS
        value: "*"

      - key: RELAY_TIMEOUT
        value: "120"

      - key: CHAIN_WAIT_MODE
        value: "true"

      - key: VALIDATION_SCHEMA_PATH
        value: "ChatGPT-API_reference_ground_truth-2025-10-29.json"
