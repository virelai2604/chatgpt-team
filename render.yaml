# ==============================================================
# Render Service Manifest
# ChatGPT Team Relay â€” Ground Truth API v1.8
# SDK Targets:
#   - openai-python 2.11.x
#   - openai-node 6.9.x
# ==============================================================

services:
  - type: web
    name: chatgpt-team-relay
    runtime: python
    repo: https://github.com/virelai2604/chatgpt-team
    branch: main
    region: singapore
    plan: starter

    # BIFL: Use the current Blueprint field (replaces deprecated autoDeploy).
    # off = do not redeploy on commits automatically.
    autoDeployTrigger: off

    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    # Render requires binding to 0.0.0.0 and the PORT env var.
    startCommand: |
      uvicorn app.main:app --host 0.0.0.0 --port $PORT

    # Render health checks use GET and must return 2xx/3xx.
    healthCheckPath: /v1/health

    envVars:
      # -------- Core relay / app mode --------
      - key: APP_MODE
        value: production
      - key: ENVIRONMENT
        value: production

      # -------- OpenAI upstream config --------
      - key: OPENAI_API_BASE
        value: https://api.openai.com/v1

      - key: OPENAI_API_KEY
        sync: false

      - key: OPENAI_ASSISTANTS_BETA
        value: assistants=v2
      - key: OPENAI_REALTIME_BETA
        value: realtime=v1

      # -------- Auth (recommended ON for production) --------
      - key: RELAY_AUTH_ENABLED
        value: true

      - key: RELAY_KEY
        sync: false

      # -------- Default models --------
      - key: DEFAULT_MODEL
        value: gpt-5.1
      - key: REALTIME_MODEL
        value: gpt-4o-realtime-preview

      # -------- Relay identity / runtime --------
      - key: RELAY_HOST
        value: 0.0.0.0
      - key: RELAY_NAME
        value: ChatGPT Team Relay
      - key: RELAY_TIMEOUT
        value: "120"
      - key: PROXY_TIMEOUT
        value: "120"

      # Render uses this env var to select Python version (must be fully qualified here).
      - key: PYTHON_VERSION
        value: "3.12.5"

      # -------- Streaming / orchestration --------
      - key: ENABLE_STREAM
        value: true
      - key: CHAIN_WAIT_MODE
        value: sequential

      # -------- CORS config (CSV, not JSON) --------
      - key: CORS_ALLOW_ORIGINS
        value: https://chat.openai.com,https://platform.openai.com
      - key: CORS_ALLOW_METHODS
        value: GET,POST,PUT,PATCH,DELETE,OPTIONS
      - key: CORS_ALLOW_HEADERS
        value: Authorization,Content-Type,Accept

      # -------- Tools & validation schema --------
      - key: TOOLS_MANIFEST
        value: app/manifests/tools_manifest.json
      - key: VALIDATION_SCHEMA_PATH
        value: ChatGPT-API_reference_ground_truth-2025-10-29.pdf

      # -------- Logging --------
      - key: LOG_LEVEL
        value: info
      - key: LOG_FORMAT
        value: json
      - key: LOG_COLOR
        value: false

      # -------- Optional (Actions) --------
      - key: CHATGPT_ACTIONS_SECRET
        sync: false

version: "1"
