openapi: 3.1.0
info:
  title: ChatGPT Team Relay API
  version: "2.0"
  description: >
    OpenAI-compatible relay API that mirrors the official /v1 routes.
    Implements SDK v2.6.1 (Python) and v6.7.0 (Node) endpoints,
    including models, embeddings, files, vector stores, realtime, and responses with tool execution.
servers:
  - url: https://chatgpt-team-relay.onrender.com
    description: Production Render deployment

tags:
  - name: models
  - name: embeddings
  - name: files
  - name: vector_stores
  - name: realtime
  - name: responses
  - name: conversations
  - name: passthrough

paths:

  /v1/models:
    get:
      tags: [models]
      summary: List all available OpenAI models
      operationId: listModels
      responses:
        "200":
          description: List of models available to the configured API key
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelList"

  /v1/embeddings:
    post:
      tags: [embeddings]
      summary: Generate text embeddings
      operationId: createEmbedding
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmbeddingRequest"
      responses:
        "200":
          description: Embedding response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmbeddingResponse"

  /v1/files:
    post:
      tags: [files]
      summary: Upload a file
      operationId: uploadFile
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: Uploaded file object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/File"

  /v1/files/{file_id}:
    get:
      tags: [files]
      summary: Retrieve file metadata
      operationId: retrieveFile
      parameters:
        - name: file_id
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: File object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/File"

  /v1/files/{file_id}/content:
    get:
      tags: [files]
      summary: Retrieve file contents
      operationId: retrieveFileContent
      parameters:
        - name: file_id
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: File content
          content:
            application/octet-stream:
              schema: { type: string, format: binary }

  /v1/vector_stores:
    post:
      tags: [vector_stores]
      summary: Create a new vector store
      operationId: createVectorStore
      responses:
        "200":
          description: Vector store metadata
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VectorStore"

  /v1/vector_stores/{vector_id}:
    get:
      tags: [vector_stores]
      summary: Retrieve a vector store
      operationId: retrieveVectorStore
      parameters:
        - name: vector_id
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Vector store object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VectorStore"
    delete:
      tags: [vector_stores]
      summary: Delete a vector store
      operationId: deleteVectorStore
      parameters:
        - name: vector_id
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deletion confirmation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VectorStoreDeleted"

  /v1/realtime/sessions:
    post:
      tags: [realtime]
      summary: Create a realtime session
      operationId: createRealtimeSession
      responses:
        "200":
          description: Realtime session created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RealtimeSession"

  /v1/realtime/events:
    post:
      tags: [realtime]
      summary: Create a realtime event
      operationId: createRealtimeEvent
      responses:
        "200":
          description: Event object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RealtimeEvent"

  /v1/responses:
    post:
      tags: [responses]
      summary: Generate a text or tool-based response
      operationId: createResponse
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResponseRequest"
      responses:
        "200":
          description: Text or tool response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Response"

  /v1/responses:stream:
    post:
      tags: [responses]
      summary: Stream a response via SSE
      operationId: streamResponse
      responses:
        "200":
          description: Streamed response
          content:
            text/event-stream:
              schema: { type: string }

  /v1/conversations:
    get:
      tags: [conversations]
      summary: List all conversations
      operationId: listConversations
      responses:
        "200":
          description: Conversation list
          content:
            application/json:
              schema:
                type: object
                properties:
                  object: { type: string }
                  data: { type: array, items: { $ref: "#/components/schemas/Conversation" } }
    post:
      tags: [conversations]
      summary: Create a new conversation
      operationId: createConversation
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Conversation"
      responses:
        "200":
          description: Conversation created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Conversation"

  /{path}:
    get:
      tags: [passthrough]
      summary: Fallback passthrough for unrecognized routes
      operationId: fallbackPassthrough
      parameters:
        - name: path
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Fallback response from OpenAI
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Fallback"

components:
  schemas:
    ModelList:
      type: object
      properties:
        object: { type: string }
        data:
          type: array
          items:
            type: object
            properties:
              id: { type: string }
              object: { type: string }

    EmbeddingRequest:
      type: object
      properties:
        input: { type: string }
        model: { type: string }

    EmbeddingResponse:
      type: object
      properties:
        object: { type: string }
        data:
          type: array
          items:
            type: object
            properties:
              embedding:
                type: array
                items: { type: number }
              index: { type: integer }

    File:
      type: object
      properties:
        id: { type: string }
        object: { type: string }
        filename: { type: string }
        created: { type: integer }
        purpose: { type: string }

    VectorStore:
      type: object
      properties:
        id: { type: string }
        object: { type: string }
        status: { type: string }
        created_at: { type: integer }

    VectorStoreDeleted:
      type: object
      properties:
        id: { type: string }
        deleted: { type: boolean }

    RealtimeSession:
      type: object
      properties:
        id: { type: string }
        object: { type: string }
        model: { type: string }
        modalities: { type: array, items: { type: string } }

    RealtimeEvent:
      type: object
      properties:
        id: { type: string }
        object: { type: string }
        session_id: { type: string }
        type: { type: string }
        status: { type: string }

    ResponseRequest:
      type: object
      properties:
        model: { type: string }
        input: { type: string }
        tools:
          type: array
          items:
            $ref: "#/components/schemas/Tool"

    Response:
      type: object
      properties:
        id: { type: string }
        object: { type: string }
        model: { type: string }
        output: { type: array, items: { type: object } }
        tool_outputs:
          type: array
          items: { $ref: "#/components/schemas/ToolOutput" }
        status: { type: string }

    Tool:
      type: object
      properties:
        type: { type: string }
        args: { type: object }

    ToolOutput:
      type: object
      properties:
        tool: { type: string }
        status: { type: string }
        output: { type: object }

    Conversation:
      type: object
      properties:
        id: { type: string }
        object: { type: string }
        title: { type: string }
        created: { type: integer }
        messages:
          type: array
          items: { type: object }

    Fallback:
      type: object
      properties:
        object: { type: string }
        status: { type: integer }
        passthrough: { type: boolean }
