name: Secret Scan (Gitleaks)

on:
  push:
    branches: ["**"]
  pull_request:
    branches: [main]
  workflow_dispatch:
  schedule:
    # Daily at 04:00 UTC
    - cron: "0 4 * * *"

concurrency:
  group: secret-scan-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  gitleaks:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Gitleaks
        uses: gitleaks/gitleaks-action@v2
        env:
          # Required for PR annotations/comments; safe to provide always.
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # If this repo is under a GitHub Organization, add a free license to repo secrets:
          # GITLEAKS_LICENSE: ${{ secrets.GITLEAKS_LICENSE }}
          #
          # (Not required for personal accounts.)
          # See marketplace docs for details.
          #
          # Optional: pin a specific version (or "latest")
          # GITLEAKS_VERSION: "latest"

          # Explicit config path (recommended)
          GITLEAKS_CONFIG: .gitleaks.toml

          # Keep the output useful but avoid noisy PR comments by default
          GITLEAKS_ENABLE_COMMENTS: "false"
          GITLEAKS_ENABLE_SUMMARY: "true"
          GITLEAKS_ENABLE_UPLOAD_ARTIFACT: "true"
